;******************************************************************************
;                         Copyright (C) 2009 RCZI
;------------------------------------------------------------------------------
; FILENAME...... mem_fpga.asm
; DATE CREATED.. 28/09/2009
; LAST MODIFIED. 28/09/2009
;------------------------------------------------------------------------------
; MODIFICATION:
;   28/09/2009 - Create
;------------------------------------------------------------------------------
;                        РЕГИСТРОВАЯ МОДЕЛЬ ПЛИС ПВ
;------------------------------------------------------------------------------
;; !: arch: tms320c64xx
;; !: sarc: all
;;
;; !: codepage: cp1251 
;;
;; !: d: Регистровая модель ПЛИС ПВ.
;; !: -:
;***sss************************************************************************ 
                .def            _REG_SELECT_FLASH_PAGE
                .def            _REG_LED
                .def            _REG_RIK_PRM_DATA               
                .def            _REG_RIK_PRD_DATA               
                .def            _REG_DS_TRANSMIT                
                .def            _REG_DS_RECEIVE                 
                .def            _REG_DS_STATUS                  
                .def            _REG_DISPL_DATA                 
                .def            _REG_DISPL_COMMAND              
                .def            _REG_NMI_CONTROL  
                .def            _REG_SENSOR_POWER_CONTROL                   
                .def            _REG_KEYBOARD_KEY     
                .def            _REG_DEVICE_STATUS              
                .def            _REG_KEY_RESET                  
                .def            _REG_RND_RESET                  
                .def            _REG_RND_NUMBER                 
                .def            _REG_SCRATCH                    
                .def            _REG_RIK_RESET                  
                .def            _REG_RIK_RESET_STATUS   
                .def            _REG_RIK_ERROR        
                .def            _REG_RIK_SELECT                 
                .def            _REG_RIK_POWER            
                .def            _REG_RIK_STATUS                 
                .def            _REG_RIK_BUFPRMPRD              

                .sect           ".mem_fpga"
;====================================================================================
;                                               Регистор выбора страници флеш (A=0x0000)
;     15   14   13   12   11   10   09   08   07   06   05   04   03   02   01   00
;    -------------------------------------------------------------------------------
; WR|    |    |    |    |    |    |    |    |    |    |    |    |    |    |PG1 |PG0 |
;    -------------------------------------------------------------------------------
;       00-     PG0 = 1 - выбрана 0 страница флеш
;       01-     PG1 = 1 - выбрана 1 страница флеш
_REG_SELECT_FLASH_PAGE          .half   0

;====================================================================================
;                                               Регистор светодиодов (A=0x0002)
;     15   14   13   12   11   10   09   08   07   06   05   04   03   02   01   00
;    -------------------------------------------------------------------------------
; WR|    |    |    |    |    |    |    |    |    |    |    |    |    |    |LED1|LED0|
;    -------------------------------------------------------------------------------
;       00-     LED0 = 1 - светодиодов включен
;       01-     LED1 = 1 - светодиодов включен
_REG_LED                                        .half   0

;====================================================================================
;                                               Регистр приема данных из РИК (A=0x0004) 
;     15   14   13   12   11   10   09   08   07   06   05   04   03   02   01   00
;    -------------------------------------------------------------------------------
; WR|    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |PRM |
;    -------------------------------------------------------------------------------
;       0-      PRM=1 - принять данные из РИК в буфер приема-передачи РИК
_REG_RIK_PRM_DATA                       .half   0
        
;====================================================================================
;                                               Регистр передачи данных из РИК (A=0x0006) 
;     15   14   13   12   11   10   09   08   07   06   05   04   03   02   01   00
;    -------------------------------------------------------------------------------
; WR|    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |PRD |
;    -------------------------------------------------------------------------------
;       0-      PRD=1 - передать данные из буфер приема-передачи РИК в РИК
_REG_RIK_PRD_DATA                       .half   0
                                                        .space  8
                                                                                                                                                
;====================================================================================
;                                               Регистр передачи данных в DS 1337 (A=0x0010) 
;     15   14   13   12   11   10   09   08   07   06   05   04   03   02   01   00
;    -------------------------------------------------------------------------------
; WR|            ADDRESS DS 1337            |               DATA                    |
;    -------------------------------------------------------------------------------
_REG_DS_TRANSMIT                        .half   0       
                                
;====================================================================================
;                                               Регистр приема данных в DS 1337 (A=0x0012) 
;     15   14   13   12   11   10   09   08   07   06   05   04   03   02   01   00
;    -------------------------------------------------------------------------------
; WR|            ADDRESS DS 1337            |    |    |    |    |    |    |    |    |
;    -------------------------------------------------------------------------------
;
;     15   14   13   12   11   10   09   08   07   06   05   04   03   02   01   00
;    -------------------------------------------------------------------------------
; RD|    |    |    |    |    |    |    |    |               DATA                    |
;    -------------------------------------------------------------------------------
_REG_DS_RECEIVE                         .half   0       
                                                        .space  2

;====================================================================================
;                                               Регистр статуса DS 1337 (A=0x0016) 
;     15   14   13   12   11   10   09   08   07   06   05   04   03   02   01   00
;    -------------------------------------------------------------------------------
; RD|    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |RDY |
;    -------------------------------------------------------------------------------
;       00-     RDY = 1 - операция чтения/записи в DS1337 завершена
_REG_DS_STATUS                          .half   0       
                                                         
;====================================================================================
;                                               Регистр передачи данных в дисплей (A=0x0018)
;     15   14   13   12   11   10   09   08   07   06   05   04   03   02   01   00
;    -------------------------------------------------------------------------------
; WR|    |    |    |    |    |    |    |    |           DISPLAY DATA BYTE           |
;    -------------------------------------------------------------------------------
_REG_DISPL_DATA                         .half   0

;====================================================================================
;                                               Регистр передачи команд в дисплей (A=0x001A)
;     15   14   13   12   11   10   09   08   07   06   05   04   03   02   01   00
;    -------------------------------------------------------------------------------
; WR|    |    |    |    |    |    |    |    |          DISPLAY COMMAND BYTE         |
;    -------------------------------------------------------------------------------
_REG_DISPL_COMMAND                      .half   0
                                                        .space  2
;====================================================================================
;                                               Регистр нажатой клавиши (A=0x001E)
;     15   14   13   12   11   10   09   08   07   06   05   04   03   02   01   00
;    -------------------------------------------------------------------------------
; RD|    |    |    |    |    |    |    |    |            KEYBOARD KEY CODE          |
;    -------------------------------------------------------------------------------
_REG_KEYBOARD_KEY               .half   0

;====================================================================================
;                                               Регистр статуса устройства (A=0x0020)
;     15   14   13   12   11   10   09   08   07   06   05   04   03   02   01   00
;    -------------------------------------------------------------------------------
; RD|    |    |    |    |    |    |    |    |    |BXOP|    |    |RND |CNSL|KBRD|DSPL|
;    -------------------------------------------------------------------------------
;       0- DSPL = 1 - дисплей готов
;       1- KBRD = 1 - нажата клавиша
;       2- CNSL = 1 - консоль открыта
;       3- RND  = 1 - готово случайное число
;       6- BXOP = 1 - открыта крышка прибора
_REG_DEVICE_STATUS                      .half   0

;====================================================================================
;                                               Регистр сброса признака нажатой клавиши (0x0022)
;     15   14   13   12   11   10   09   08   07   06   05   04   03   02   01   00
;    -------------------------------------------------------------------------------
; WR|    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |RKB |
;    -------------------------------------------------------------------------------
;       0- RKB = 1 - сбросить признак  REG_DEVICE_STATUS[KBRD]
_REG_KEY_RESET                          .half   0

;====================================================================================
;                                               Регистр сброса случайного числа (0x0024)
;     15   14   13   12   11   10   09   08   07   06   05   04   03   02   01   00
;    -------------------------------------------------------------------------------
; WR|    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |NRND|
;    -------------------------------------------------------------------------------
;       0- NRND = 1 - подготовить новое случайное число
_REG_RND_RESET                          .half   0
                                                        .space  4
;====================================================================================
;                                               Регистр случайного числа (А=0x002A)
;     15   14   13   12   11   10   09   08   07   06   05   04   03   02   01   00
;    -------------------------------------------------------------------------------
; RD|       RND NUMMBER CHANEL 0            |      RND NUMMBER CHANEL 1             |
;    -------------------------------------------------------------------------------
_REG_RND_NUMBER                         .half   0
                                                        .space  4                       
;====================================================================================
;                                               Регистор scratch (A=0x0030)
;     15   14   13   12   11   10   09   08   07   06   05   04   03   02   01   00
;    -------------------------------------------------------------------------------
; RW|                                  FOR SCRATCH                                  |
;    -------------------------------------------------------------------------------
_REG_SCRATCH                            .half   0
                                                        .space  2
;====================================================================================
;                                               Регистр управления NMI (A=0x0034)
;     15   14   13   12   11   10   09   08   07   06   05   04   03   02   01   00
;    -------------------------------------------------------------------------------
; WD|    |    |    |    |    |    |    |    |    |    |    |    |RNMI|    |SNMI| IE |
;    -------------------------------------------------------------------------------
;       00- IE   =1 - немаскируемое прерывание включено
;       01- SNMI =1 - подготовка SW NMI
;       01- SNMI =0 - генерация SW NMI
;       03- RNMI =1 - сброс регистра управления NMI
;
;     15   14   13   12   11   10   09   08   07   06   05   04   03   02   01   00
;    -------------------------------------------------------------------------------
; RD|    |    |    |    |    |    |    |    |    |    |    |    |PWRI|BRDI|PPI |NPI |
;    -------------------------------------------------------------------------------
;       00- NPI  =1 - прерывание от сетевого процессора
;       01- PPI  =1 - прерывание от переферийного процессора
;       02- BRDI =1 - прерывание от крышки прибора
;       03- PWRI =1 - прерывание по выключении питания прибора
_REG_NMI_CONTROL                .half   0
                                                        .space  2
;====================================================================================
;                          Регистр управления питанием датчика (A=0x0036)
;     15   14   13   12   11   10   09   08   07   06   05   04   03   02   01   00
;    -------------------------------------------------------------------------------
; WD|    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |SPWR|
;    -------------------------------------------------------------------------------
;       00-     SPWR =1 - питание выключенно
;       00-     SPWR =0 - питание включенно
; note: Результат проверять в регистре статуса устройства (REG_DEVICE_STATUS) 
;       минимум через 5 мкс.
_REG_SENSOR_POWER_CONTROL   .half       0
                                                        .space  6
;====================================================================================
;                                               Регистр сброса РИК (A=0x0040)
;     15   14   13   12   11   10   09   08   07   06   05   04   03   02   01   00
;    -------------------------------------------------------------------------------
; WR|    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |RES |
;    -------------------------------------------------------------------------------
;       0- RES=1 - сброс выбранного РИК
_REG_RIK_RESET                          .half   0      
                                                        .space  2                   
;====================================================================================
;                                               Регистр сброса статуса РИК (А=0x0044)
;     15   14   13   12   11   10   09   08   07   06   05   04   03   02   01   00
;    -------------------------------------------------------------------------------
; WR|    |    |    |    |    |    |    |    |    |RSDR|    |RSC2|RSC1|    |    |RST |
;    -------------------------------------------------------------------------------
;       0-      RSTST=1 - сброс бита ST регистра состояния РИК (А=4Сh).
;       3-      RSTC1=1 - сброс бита RC1 регистра состояния РИК (А=4Сh).
;       4-      RSTC2=1 - сброс бита RC2 регистра состояния РИК (А=4Сh).
;       6-      RSTDR=1 - сброс бита DR регистра состояния РИК (А=4Сh).
_REG_RIK_RESET_STATUS           .half   0     
                                                        .space  2                   
;====================================================================================
;               Регистр ошибок РИК (на чтение)/Регистр выбора РИК (на запись) (А=0x0048)
;     15   14   13   12   11   10   09   08   07   06   05   04   03   02   01   00
;    -------------------------------------------------------------------------------
; RD|                                   ERROR CODE                                  |
;    -------------------------------------------------------------------------------
;
;     15   14   13   12   11   10   09   08   07   06   05   04   03   02   01   00
;    -------------------------------------------------------------------------------
; WR|    |    |    |    |    |    |    |    |    |    |    |    |    |    |    | ID |
;    -------------------------------------------------------------------------------
;               ID = 0 выбран РИК 1
;               ID = 1 выбран РИК 2
_REG_RIK_ERROR                                                         
_REG_RIK_SELECT                         .half   0               
                                                        .space  2                   
;====================================================================================
;               Регистр статуса РИК (на чтение)/Регистр подачи питания РИК (А=0x004C)
;     15   14   13   12   11   10   09   08   07   06   05   04   03   02   01   00
;    -------------------------------------------------------------------------------
; RD|    |    |    |    |    |    |    |    |    |CDR |DR  |RC2 |RC1 |RS2 |RS1 | ST |
;    -------------------------------------------------------------------------------
;       Все биты данного регистра устанавливаются контроллером РИК.
;       00-     ST  = 1 - РИК (активный) выполнил команду
;       01-     RS1 = 1 - карточка вставлена в считыватель РИК1
;       02-     RS2 = 1 - карточка вставлена в считыватель РИК2
;       03-     RC1 = 1 - было изменение в считывателе РИК1
;       04-     RC2 = 1 - было изменение в считывателе РИК2
;       05-     DR  = 1 - открыта крышка РИК
;       06-     CDR = 1 - была открыта/закрыта крышка РИК
;       Бит ST сбрасывается записью 1 в бит RSTST регистра сброса бита готовности РИК (A=22h  (Write)).
;       Биты RC1, RC2 сбрасываются записью 1 в биты RSTRC1, RSTRC2  регистра сброса бита готовности РИК (A=22h  (Write)).
;       Биты CDR сбрасывается записью 1 в биты RSTDR  регистра сброса бита готов-ности РИК (A=22h  (Write)).
;       После установки в 1 битов RC1, RC2, CDR выдается прерывание контроллером РИК (GPIO12).
;
;     15   14   13   12   11   10   09   08   07   06   05   04   03   02   01   00
;    -------------------------------------------------------------------------------
; WR|    |    |    |    |    |    |    |    |    |    |DPW2|DPW1|    |    |PWR2|PWR1|
;    -------------------------------------------------------------------------------
;       0- PWR1 = 1 - включение  питания РИК1
;       1- PWR2 = 1 - включение  питания РИК2
;       4- DPW1 = 1 - выключение питания РИК1
;       5- DPW2 = 1 - выключение питания РИК2
_REG_RIK_STATUS
_REG_RIK_POWER                                       
                                                        .half   0               
                                                        .space  50
;====================================================================================
;                                                       Буфер данных/команд РИК [A=0x0080-0x010A]
;     15   14   13   12   11   10   09   08   07   06   05   04   03   02   01   00
;    -------------------------------------------------------------------------------
; RW|    |    |    |    |    |    |    |    |           DATA/COMMAND                |
;    -------------------------------------------------------------------------------
_REG_RIK_BUFPRMPRD                      .space  (5+64)<<1       ;0x60000080 ;RW

;====================================================================================
NO_REG
